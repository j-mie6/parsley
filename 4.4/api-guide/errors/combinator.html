<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Typelevel Laika + Parsley Theme" />
    
    <title>Error Message Combinators (parsley.errors.combinator)</title>
    
    
    <meta name="author" content="parsley contributors"/>
    
    
    <meta name="description" content="This page describes how to generate informative errors."/>
    
    
    
    <link rel="icon" sizes="32x32" type="image/svg+xml" href="../../../icons/greenLeaf.svg"/>
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
    
    <link rel="stylesheet" type="text/css" href="../../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../../css/parsley-style.css" />
    <script src="../../../helium/site/laika-helium.js"></script>
    <script src="../../../helium/site/laika-versions.js"></script>
    <script>initVersions("../../../", "/api-guide/errors/combinator.html", "4.4", null);</script>
    
    <script> /* for avoiding page load transitions */ </script>
  </head>


  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    <div class="menu-container version-menu">
      <a class="text-link menu-toggle" href="#">Version 4.4.x</a>
      <nav class="menu-content">
        <ul class="nav-list">
        </ul>
      </nav>
    </div>
  </div>

  <a class="icon-link svg-link" href="../../../"><span class="leaf" title="Home"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M101.39,86.21c-14.25-5.91-22.34-4.3-28.47-2.5c-6.5,1.91-12.31,8.58-12.31,8.58s-1.93-0.58-5.04-0.51 c-1.49,0.04-2.67,0.28-3.54,0.54c2.64-5.99,4.51-12.08,7.57-18.76c1.95-0.81,4.63-1.86,6.35-2.23c2.96-0.64,6.45-0.84,6.45-0.84 c0.82,0.64,2,1.39,3.69,2.23c9.56,4.78,21.5,2.16,27.35-0.16c8.13-3.23,20.21-12.95,20.21-13.69s-5.5-3.38-13.32-5.71 c-7.82-2.33-18.27-2.44-26.21,0.95c-7.28,3.11-10.67,8.58-12.54,11.86c0,0-2.9,0.46-5,0.82c-1.56,0.27-2.96,0.64-4.07,0.99 c0.22-0.4,0.45-0.81,0.68-1.21C67.77,58.61,72.83,52.5,77,48.2c5.87,0.55,17.89,0.35,27.62-8.46 c15.64-14.15,18.46-35.92,18.07-36.35S97.35,3.34,84.54,14.91c-12.19,11.01-11.97,25.4-11.4,30.69c-3.97,3.71-8.81,9.17-14.2,17.12 c-0.04-2.12-0.29-4.73-0.29-4.73s7.19-6.73,7.72-17.18c0.42-8.24-0.46-15.89-5-24.14c-3.56-6.43-6.53-8.03-7.06-7.93 c-0.93,0.19-5.33,7.06-8.03,13.63c-2.13,5.17-4.26,18.38-0.45,26.52s8.22,9.68,8.22,9.68s0.54,2.37,0.48,5.55 c-0.02,1.36-0.13,4.51-0.18,5.98c-3.57,6.32-5.96,12.07-8.23,17.22c-0.34-0.99-0.73-1.96-1.11-2.65c-1.16-2.11-1.59-2.85-1.59-2.85 s2.57-15.99-1.8-29.17C36.45,37,27.57,31.08,19.33,27.59C11.09,24.1,6.54,24.11,5.8,24.95c-1.08,1.23,1.37,4.33,1.59,11.31 c0.17,5.71,1.16,25.05,6.87,34.98s13.63,12.37,16.17,13.21c2.54,0.85,8.03,0.95,8.03,0.95s2.33,2.01,3.17,4.86 c0.39,1.31,0.78,2.92,1.09,4.27c-1.95,3.71-4.17,7-7.21,9.86c-5.01,4.71-13.09,7.94-13.09,7.94s-6.47-0.15-6.91,0.15 c-0.44,0.29-1.73,3.53,0.69,7.51c2,3.29,5.05,4.12,6.08,4.26c1.03,0.15,2.94-4.27,3.68-4.86c0.74-0.59,9.43-3.93,15.6-10.74 c2.83-3.13,5.02-6.16,6.81-9.17c1.65-1.01,4.07-2.17,6.72-2.31c2.64-0.15,4.94,1.12,4.94,1.12s2.22,9.16,12.15,13 c12.5,4.83,25.83,0.61,31.64-1.4c5.81-2,19.83-8.42,19.94-10.22C123.86,97.87,115.66,92.13,101.39,86.21z"/>
  </g>
</svg></span></a>

  <div class="row links">
    
    <a class="text-link" href="https://www.javadoc.io/doc/com.github.j-mie6/parsley_2.13/4.4.0/">API</a>
    
    <a class="icon-link svg-link" href="https://github.com/j-mie6/parsley"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="text-link" href="https://www.javadoc.io/doc/com.github.j-mie6/parsley_2.13/4.4.0/">API</a>
    
    <a class="icon-link svg-link" href="https://github.com/j-mie6/parsley"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../../downloads.html">Documentation Downloads</a></li>
    <li class="level1 nav-leaf"><a href="../../../home.html">Home</a></li>
    <li class="level1 nav-leaf"><a href="../../faq.html">FAQ</a></li>
    <li class="level1 nav-leaf"><a href="../../cheatsheet.html">Cheatsheet</a></li>
    <li class="level1 nav-node"><a href="../">Understanding the API</a></li>
    <li class="level2 nav-leaf"><a href="../Parsley.html"><code>parsley.Parsley</code></a></li>
    <li class="level2 nav-leaf"><a href="../character.html"><code>parsley.character</code></a></li>
    <li class="level2 nav-leaf"><a href="../combinator.html"><code>parsley.combinator</code></a></li>
    <li class="level2 nav-leaf"><a href="../generic.html"><code>parsley.genericbridges</code></a></li>
    <li class="level2 nav-leaf"><a href="../syntax.html"><code>parsley.implicits</code></a></li>
    <li class="level2 nav-leaf"><a href="../position.html"><code>parsley.position</code></a></li>
    <li class="level2 nav-leaf"><a href="../state.html"><code>parsley.registers</code></a></li>
    <li class="level2 nav-leaf"><a href="../debug.html"><code>parsley.debug</code></a></li>
    <li class="level2 nav-header"><code>parsley.expr</code></li>
    <li class="level3 nav-leaf"><a href="../expr/chain.html"><code>chain</code></a></li>
    <li class="level3 nav-leaf"><a href="../expr/infix.html"><code>infix</code></a></li>
    <li class="level3 nav-leaf"><a href="../expr/precedence.html"><code>precedence</code></a></li>
    <li class="level2 nav-header"><code>parsley.token</code></li>
    <li class="level3 nav-leaf"><a href="../token/Lexer.html"><code>Lexer</code></a></li>
    <li class="level3 nav-leaf"><a href="../token/descriptions.html"><code>descriptions</code></a></li>
    <li class="level3 nav-leaf"><a href="../token/errors.html"><code>errors</code></a></li>
    <li class="level2 nav-header"><code>parsley.errors</code></li>
    <li class="level3 active nav-leaf"><a href="#"><code>combinator</code></a></li>
    <li class="level3 nav-leaf"><a href="patterns.html"><code>patterns</code></a></li>
    <li class="level3 nav-leaf"><a href="ErrorBuilder.html"><code>ErrorBuilder</code></a></li>
    <li class="level3 nav-leaf"><a href="tokenextractors.html"><code>tokenextractors</code></a></li>
    <li class="level1 nav-node"><a href="../../tutorial/">Parser Combinator Tutorial</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/basics-of-combinators.html">Basics of Combinators</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/building-expression-parsers.html">Building Expression Parsers</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/effective-whitespace-parsing.html">Effective Whitespace Parsing</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/effective-lexing.html">Effective Lexing</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/parser-bridge-pattern.html">The Parser Bridge Pattern</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/interlude-1-haskell.html">Interlude 1: Building a Parser for Haskell</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/customising-error-messages.html">Customising Error Messages</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/advanced-error-messages.html">Advanced Error Messages</a></li>
    <li class="level1 nav-header">Related Projects</li>
    <li class="level2 nav-leaf"><a href="https://github.com/j-mie6/parsley-cats">parsley-cats</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/j-mie6/gigaparsec">gigaparsec (Haskell)</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#"><code>combinator</code></a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#failure-combinators">Failure Combinators</a></li>
    <li class="level2 nav-leaf"><a href="#the-unexpected-combinator">The <code>unexpected</code> Combinator</a></li>
    <li class="level2 nav-leaf"><a href="#the-fail-combinator">The <code>fail</code> Combinator</a></li>
    <li class="level1 nav-node"><a href="#error-enrichment">Error Enrichment</a></li>
    <li class="level2 nav-leaf"><a href="#the-label-combinator">The <code>label</code> Combinator</a></li>
    <li class="level2 nav-leaf"><a href="#the-explain-combinator">The <code>explain</code> Combinator</a></li>
    <li class="level2 nav-leaf"><a href="#the-hide-combinator">The <code>hide</code> Combinator</a></li>
    <li class="level1 nav-node"><a href="#error-adjustment-combinators">Error Adjustment Combinators</a></li>
    <li class="level2 nav-leaf"><a href="#the-amend-combinator">The <code>amend</code> Combinator</a></li>
    <li class="level2 nav-leaf"><a href="#the-entrench-and-dislodge-combinators">The <code>entrench</code> and <code>dislodge</code> Combinators</a></li>
    <li class="level2 nav-leaf"><a href="#the-markastoken-combinator">The <code>markAsToken</code> Combinator</a></li>
  </ul>

  <p class="footer"><a href="https://github.com/j-mie6/parsley/blob/wiki-improvements/docs/api-guide/errors/combinator.md"><i class="icofont-laika edit" title="Edit">&#xef10;</i>Source for this page</a></p>
</nav>


      <main class="content">

        <h1 id="error-message-combinators" class="title">Error Message Combinators</h1>
        <p>Aside from the failures generated by character consumption, <code>parsley</code> has
        many combinators for both generating failures unconditionally, as well as
        augenting existing errors with more information. These are found within
        the <code>parsley.errors.combinator</code> module.</p>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p><em>The Scaladoc for this page can be found at <a class="api" href="https://www.javadoc.io/doc/com.github.j-mie6/parsley_2.13/4.4.0/parsley/errors/combinator$.html"><code>parsley.errors.combinator</code></a>.</em></p>
        </div>
        
        <h2 id="failure-combinators" class="section"><a class="anchor-link left" href="#failure-combinators"><i class="icofont-laika link">&#xef71;</i></a>Failure Combinators</h2>
        <p>Normally, failures can be generated by <code>empty</code>, <code>satisfy</code>, <code>string</code>, and
        <code>notFollowedBy</code>; as well as their derivatives. However, those do not capture the
        full variety of &quot;unexpected&quot; parts of error messages. In the below table, <code>empty</code>
        corresponds to <code>empty(0)</code> (these are both found in <code>parsley.Parsley</code>). The
        <em>named</em> items are produced by <code>unexpected</code> combinators, and wider carets of
        <em>empty</em> items can be obtained by passing wider values to <code>empty</code>. This is summarised in the table below.</p>
        <table>
          <thead>
            <tr>
              <th>Caret</th>
              <th><em>empty</em></th>
              <th><em>raw/eof</em></th>
              <th><em>named</em></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>0</code></td>
              <td><code>empty(0)</code></td>
              <td>n/a</td>
              <td><code>unexpected(0, _)</code></td>
            </tr>
            <tr>
              <td><code>1</code></td>
              <td><code>empty(1)</code></td>
              <td><code>satisfy</code></td>
              <td><code>unexpected(1, _)</code></td>
            </tr>
            <tr>
              <td><code>n</code></td>
              <td><code>empty(n)</code></td>
              <td><code>string</code></td>
              <td><code>unexpected(n, _)</code></td>
            </tr>
          </tbody>
        </table>
        
        <h3 id="the-unexpected-combinator" class="section"><a class="anchor-link left" href="#the-unexpected-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>unexpected</code> Combinator</h3>
        <p>The <code>unexpected</code> combinator fails immediately, but produces a given name as
        the unexpected component of the error message with a caret as wide as the
        given integer. For instance:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">character</span><span>.</span><span class="identifier">char</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">errors</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="identifier">unexpected</span><span>

</span><span class="identifier">unexpected</span><span>(</span><span class="number-literal">3</span><span>, </span><span class="string-literal">&quot;foo&quot;</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;abcd&quot;</span><span>)
</span><span class="comment">// res0: parsley.Result[String, Nothing] = Failure((line 1, column 1):
//   unexpected foo
//   &gt;abcd
//    ^^^)
</span><span>(</span><span class="identifier">char</span><span>(</span><span class="char-literal">&#39;a&#39;</span><span>) | </span><span class="identifier">unexpected</span><span>(</span><span class="string-literal">&quot;not an a&quot;</span><span>)).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;baa&quot;</span><span>)
</span><span class="comment">// res1: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected not an a
//   expected &quot;a&quot;
//   &gt;baa
//    ^)</span></code></pre>
        <p>There are a few things to note about the above examples:</p>
        <ul>
          <li>Just using <code>unexpected</code> alone does not introduce any other components, like
          expected items, to the error</li>
          <li>When the caret width is unspecified, it will adapt to whatever the
          caret would have been for the error message</li>
          <li>The <em>named</em> items resulting from the combinator <em>dominate</em> other kinds of
          item, so that <code>char(&#39;a&#39;)</code>&#39;s natural &quot;unexpected &#39;a&#39;&quot; disappears</li>
        </ul>
        
        <h3 id="the-fail-combinator" class="section"><a class="anchor-link left" href="#the-fail-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>fail</code> Combinator</h3>
        <p>In contrast to the <code>unexpected</code> combinator, which produces <em>vanilla</em> errors, the
        <code>fail</code> combinator produces <em>specialised</em> errors, which suppress all other
        components of an error in favour of some specific messages.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">character</span><span>.</span><span class="identifier">string</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">errors</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="identifier">fail</span><span>

</span><span class="identifier">fail</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="string-literal">&quot;msg1&quot;</span><span>, </span><span class="string-literal">&quot;msg2&quot;</span><span>, </span><span class="string-literal">&quot;msg3&quot;</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;abc&quot;</span><span>)
</span><span class="comment">// res2: parsley.Result[String, Nothing] = Failure((line 1, column 1):
//   msg1
//   msg2
//   msg3
//   &gt;abc
//    ^^)
</span><span>(</span><span class="identifier">fail</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;msg1&quot;</span><span>) | </span><span class="identifier">fail</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="string-literal">&quot;msg2&quot;</span><span>) | </span><span class="identifier">fail</span><span>(</span><span class="string-literal">&quot;msg3&quot;</span><span>)).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;abc&quot;</span><span>)
</span><span class="comment">// res3: parsley.Result[String, Nothing] = Failure((line 1, column 1):
//   msg1
//   msg2
//   msg3
//   &gt;abc
//    ^^)
</span><span>(</span><span class="identifier">fail</span><span>(</span><span class="string-literal">&quot;msg&quot;</span><span>) | </span><span class="identifier">string</span><span>(</span><span class="string-literal">&quot;abc&quot;</span><span>)).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;xyz&quot;</span><span>)
</span><span class="comment">// res4: parsley.Result[String, String] = Failure((line 1, column 1):
//   msg
//   &gt;xyz
//    ^^^)
</span><span>(</span><span class="identifier">fail</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;msg&quot;</span><span>) | </span><span class="identifier">string</span><span>(</span><span class="string-literal">&quot;abc&quot;</span><span>)).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;xyz&quot;</span><span>)
</span><span class="comment">// res5: parsley.Result[String, String] = Failure((line 1, column 1):
//   msg
//   &gt;xyz
//    ^)</span></code></pre>
        <p>Notice that if a caret width is specified, it will override any other
        carets from other combinators, like <code>string</code>. Not specifying a caret
        is adaptive. The <code>fail</code> combinator also suppressed other error messages,
        and merges within itself as if all the messages were generated by one
        <code>fail</code>.</p>
        
        <h2 id="error-enrichment" class="section"><a class="anchor-link left" href="#error-enrichment"><i class="icofont-laika link">&#xef71;</i></a>Error Enrichment</h2>
        <p>Other than the freestanding combinators, some combinators are enabled
        by importing <code>parsley.errors.combinator.ErrorMethods</code>. Some of these
        are involved with augmenting error messages with additional information.
        These are discussed below.</p>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p>None of the combinators in this section have any effect on <code>fail</code> or its
          derivatives.</p>
        </div>
        
        <h3 id="the-label-combinator" class="section"><a class="anchor-link left" href="#the-label-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>label</code> Combinator</h3>
        <p>When combinators that read characters fail, they produce &quot;expected&quot; components
        in error messages:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">character</span><span>.{</span><span class="identifier">char</span><span>, </span><span class="identifier">string</span><span>, </span><span class="identifier">satisfy</span><span>}

</span><span class="identifier">char</span><span>(</span><span class="char-literal">&#39;a&#39;</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;b&quot;</span><span>)
</span><span class="comment">// res6: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;b&quot;
//   expected &quot;a&quot;
//   &gt;b
//    ^)
</span><span class="identifier">string</span><span>(</span><span class="string-literal">&quot;abc&quot;</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;xyz&quot;</span><span>)
</span><span class="comment">// res7: parsley.Result[String, String] = Failure((line 1, column 1):
//   unexpected &quot;xyz&quot;
//   expected &quot;abc&quot;
//   &gt;xyz
//    ^^^)
</span><span class="identifier">satisfy</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">isDigit</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;a&quot;</span><span>)
</span><span class="comment">// res8: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;a&quot;
//   &gt;a
//    ^)</span></code></pre>
        <p>Notice that the <code>satisfy</code> combinator cannot produce an expected item because
        nothing is known about the function passed in. The other two produce <em>raw</em>
        expected items. The <code>label</code> combinator can be used to replace these and generate
        <em>named</em> items. This is employed by <code>parsley.character</code> for its more specific
        parsers:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">errors</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="type-name">ErrorMethods</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">digit</span><span> = </span><span class="identifier">satisfy</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">isDigit</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;digit&quot;</span><span>)
</span><span class="comment">// digit: parsley.Parsley[Char] = parsley.Parsley@7d665ad4
</span><span class="identifier">digit</span><span>.</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;a&quot;</span><span>)
</span><span class="comment">// res9: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;a&quot;
//   expected digit
//   &gt;a
//    ^)</span></code></pre>
        <p>The <code>label</code> combinator above has added the label <code>digit</code> to the parser. If
        there was an existing label there, it would have been replaced.</p>
        <div class="callout error">
          <i class="icofont-laika error">&#xeedd;</i>
          <p>A <code>label</code> combinator cannot be provided with <code>&quot;&quot;</code>. In other libraries, this may
          represent hiding, however in <code>parsley</code>, the <code>hide</code> combinator is distinct.</p>
        </div>
        <p>A <code>label</code> combinator, along with other combinators, only applies if the
        error message properly lines up with the point the input was at when it
        entered the combinator - otherwise, the label may be inaccurate. For example:</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">twoDigits</span><span> = (</span><span class="identifier">digit</span><span> *&gt; </span><span class="identifier">digit</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;two digits&quot;</span><span>)
</span><span class="comment">// twoDigits: parsley.Parsley[Char] = parsley.Parsley@3febcf55
</span><span class="identifier">twoDigits</span><span>.</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;a&quot;</span><span>)
</span><span class="comment">// res10: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;a&quot;
//   expected two digits
//   &gt;a
//    ^)
</span><span class="identifier">twoDigits</span><span>.</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;1a&quot;</span><span>)
</span><span class="comment">// res11: parsley.Result[String, Char] = Failure((line 1, column 2):
//   unexpected &quot;a&quot;
//   expected digit
//   &gt;1a
//     ^)</span></code></pre>
        
        <h3 id="the-explain-combinator" class="section"><a class="anchor-link left" href="#the-explain-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>explain</code> Combinator</h3>
        <p>The <code>explain</code> combinator allows for the addition of further lines of error
        message, providing more high-level reasons for the error or explanations about
        a syntactic construct. It behaves similarly to <code>label</code> in that it will only
        apply when the position of the error message matches the offset that the combinator entered at.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">errors</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="type-name">ErrorMethods</span><span>

</span><span class="identifier">digit</span><span>.</span><span class="identifier">explain</span><span>(</span><span class="string-literal">&quot;a digit is needed, for some reason&quot;</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;a&quot;</span><span>)
</span><span class="comment">// res12: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;a&quot;
//   expected digit
//   a digit is needed, for some reason
//   &gt;a
//    ^)</span></code></pre>
        <div class="callout error">
          <i class="icofont-laika error">&#xeedd;</i>
          <p>A <code>explain</code> combinator cannot be provided with <code>&quot;&quot;</code>.</p>
        </div>
        
        <h3 id="the-hide-combinator" class="section"><a class="anchor-link left" href="#the-hide-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>hide</code> Combinator</h3>
        <p>Sometimes, a parser should not appear in an error message. A good example is
        whitespace, which is <em>almost</em> never the solution to any parsing problem, and
        would otherwise distract from rest of the error content. The <code>hide</code> combinator
        can be used to suppress a parser from appearing in the rest of a message:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">errors</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="type-name">ErrorMethods</span><span>

(</span><span class="identifier">char</span><span>(</span><span class="char-literal">&#39;a&#39;</span><span>) | </span><span class="identifier">digit</span><span>.</span><span class="identifier">hide</span><span>).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;b&quot;</span><span>)
</span><span class="comment">// res13: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;b&quot;
//   expected &quot;a&quot;
//   &gt;b
//    ^)</span></code></pre>
        
        <h2 id="error-adjustment-combinators" class="section"><a class="anchor-link left" href="#error-adjustment-combinators"><i class="icofont-laika link">&#xef71;</i></a>Error Adjustment Combinators</h2>
        <p>The previous combinators in this page have been geared at adding additional
        richer information to the parse errors. However, these combinators are used to
        adjust the existing information, mostly relating to position, to ensure the
        error remains specific.</p>
        
        <h3 id="the-amend-combinator" class="section"><a class="anchor-link left" href="#the-amend-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>amend</code> Combinator</h3>
        <p>The <code>amend</code> combinator can adjust the position of an error message so that it
        occurs at an earlier position. This means that it can be affected by other
        combinators like <code>label</code> and <code>explain</code>. This is a precision tool, designed
        for fine-tuning error messages.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">errors</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="identifier">amend</span><span>

</span><span class="identifier">amend</span><span>(</span><span class="identifier">digit</span><span> *&gt; </span><span class="identifier">char</span><span>(</span><span class="char-literal">&#39;a&#39;</span><span>)).</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;9b&quot;</span><span>)
</span><span class="comment">// res14: parsley.Result[String, Char] = Failure((line 1, column 1):
//   unexpected &quot;9&quot;
//   expected &quot;a&quot;
//   &gt;9b
//    ^)</span></code></pre>
        <p>Notice that the above error makes no sense. This is why <code>amend</code> is a precision
        tool: it should ideally be used in conjunction with other combinators. For instance:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">character</span><span>.</span><span class="identifier">charLift</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">combinator</span><span>.</span><span class="identifier">choice</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="identifier">character</span><span>.{</span><span class="identifier">noneOf</span><span>, </span><span class="identifier">stringOfMany</span><span>}

</span><span class="keyword">val</span><span> </span><span class="identifier">escapeChar</span><span> = </span><span class="identifier">choice</span><span>(</span><span class="char-literal">&#39;n&#39;</span><span>.</span><span class="identifier">as</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\n</span><span class="char-literal">&#39;</span><span>), </span><span class="char-literal">&#39;t&#39;</span><span>.</span><span class="identifier">as</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\t</span><span class="char-literal">&#39;</span><span>), </span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span><span>, </span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">strLetter</span><span> =
    </span><span class="identifier">noneOf</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span><span>, </span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;string char&quot;</span><span>) | (</span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span> ~&gt; </span><span class="identifier">escapeChar</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;escape char&quot;</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">strLit</span><span> = </span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span><span> ~&gt; </span><span class="identifier">stringOfMany</span><span>(</span><span class="identifier">strLetter</span><span>) &lt;~ </span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">strLit</span><span>.</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;</span><span class="escape-sequence">\&quot;\\</span><span class="string-literal">b</span><span class="escape-sequence">\&quot;</span><span class="string-literal">&quot;</span><span>)
</span><span class="comment">// res15: parsley.Result[String, String] = Failure((line 1, column 3):
//   unexpected &quot;b&quot;
//   expected &quot;&quot;&quot;, &quot;\&quot;, &quot;n&quot;, or &quot;t&quot;
//   &gt;&quot;\b&quot;
//      ^)</span></code></pre>
        <p>In the above error, it is not <em>entirely</em> clear why the presented characters
        are expected. Perhaps it would be better to highlight a correct escape
        character instead? The <code>amend</code> combinator can be used in this case to pull
        the error back and rectify it:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">strLetter</span><span> = </span><span class="identifier">noneOf</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span><span>, </span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;string char&quot;</span><span>) |
                </span><span class="identifier">amend</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span> ~&gt; </span><span class="identifier">escapeChar</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;escape char&quot;</span><span>)</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">strLit</span><span>.</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;</span><span class="escape-sequence">\&quot;\\</span><span class="string-literal">b</span><span class="escape-sequence">\&quot;</span><span class="string-literal">&quot;</span><span>)
</span><span class="comment">// res16: parsley.Result[String, String] = Failure((line 1, column 2):
//   unexpected &quot;\&quot;
//   expected escape char or string char
//   &gt;&quot;\b&quot;
//     ^)</span></code></pre>
        <p>While the <code>amend</code> has pulled the error back, and thanks to the <code>label</code> the
        error is still sensible, it could be improved by widening the caret and
        providing an explanation:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">parsley</span><span>.</span><span class="type-name">Parsley</span><span>.</span><span class="identifier">empty</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">escapeChar</span><span> = </span><span class="identifier">choice</span><span>(</span><span class="char-literal">&#39;n&#39;</span><span>.</span><span class="identifier">as</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\n</span><span class="char-literal">&#39;</span><span>), </span><span class="char-literal">&#39;t&#39;</span><span>.</span><span class="identifier">as</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\t</span><span class="char-literal">&#39;</span><span>), </span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span><span>, </span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span>) | </span><span class="identifier">empty</span><span>(</span><span class="number-literal">2</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">strLetter</span><span> = </span><span class="identifier">noneOf</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\&quot;</span><span class="char-literal">&#39;</span><span>, </span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span>).</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;string char&quot;</span><span>) |
                </span><span class="identifier">amend</span><span>(</span><span class="char-literal">&#39;</span><span class="escape-sequence">\\</span><span class="char-literal">&#39;</span><span> ~&gt; </span><span class="identifier">escapeChar</span><span>)
                  .</span><span class="identifier">label</span><span>(</span><span class="string-literal">&quot;escape char&quot;</span><span>)
                  .</span><span class="identifier">explain</span><span>(</span><span class="string-literal">&quot;escape characters are </span><span class="escape-sequence">\\</span><span class="string-literal">n, </span><span class="escape-sequence">\\</span><span class="string-literal">t, </span><span class="escape-sequence">\\\&quot;</span><span class="string-literal">, or </span><span class="escape-sequence">\\\\</span><span class="string-literal">&quot;</span><span>)</span></code></pre>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">strLit</span><span>.</span><span class="identifier">parse</span><span>(</span><span class="string-literal">&quot;</span><span class="escape-sequence">\&quot;\\</span><span class="string-literal">b</span><span class="escape-sequence">\&quot;</span><span class="string-literal">&quot;</span><span>)
</span><span class="comment">// res17: parsley.Result[String, String] = Failure((line 1, column 2):
//   unexpected &quot;\b&quot;
//   expected escape char or string char
//   escape characters are \n, \t, \&quot;, or \\
//   &gt;&quot;\b&quot;
//     ^^)</span></code></pre>
        <p>Note, an <code>unexpected</code> could also have been used instead of <code>empty</code> to good effect.</p>
        
        <h3 id="the-entrench-and-dislodge-combinators" class="section"><a class="anchor-link left" href="#the-entrench-and-dislodge-combinators"><i class="icofont-laika link">&#xef71;</i></a>The <code>entrench</code> and <code>dislodge</code> Combinators</h3>
        <p>The <code>amend</code> combinator will indiscriminately adjust error messages
        so thay they occur earlier. However, sometimes only errors from some
        parts of a parser should be repositioned. The <code>entrench</code> combinator
        protects errors from within its scope from being amended, and
        <code>dislodge</code> undoes that protection.</p>
        <p>This can be useful if you want an error to be able to <em>dominate</em> another one, and then be amended
        afterwards, without affecting the original error. This normally has the following pattern:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">p</span><span> = </span><span class="identifier">amendThenDislodge</span><span>(</span><span class="number-literal">1</span><span>) {
    </span><span class="identifier">entrench</span><span>(</span><span class="identifier">q</span><span>) | </span><span class="identifier">r</span><span>
}</span></code></pre>
        <p>In this example, we believe that <code>r</code> will produce errors deeper than <code>q</code>s, but after it discards
        <code>q</code>s message should be reset to an earier point. On the other hand, <code>q</code> is protected from the initial
        amendment, but then is free to be amended again after the <code>dislodge</code> has removed the protection.</p>
        
        <h3 id="the-markastoken-combinator" class="section"><a class="anchor-link left" href="#the-markastoken-combinator"><i class="icofont-laika link">&#xef71;</i></a>The <code>markAsToken</code> Combinator</h3>
        <p>The <code>markAsToken</code> combinator will assign the &quot;lexical&quot; property to any error messages that happen within its scope at a <em>deeper</em> position than the combinator
        began at. This is fed forward onto the <code>unexpectedToken</code> method of the <code>ErrorBuilder</code>: more about this in <a href="tokenextractors.html#token-extraction-in-errorbuilder">lexical extraction</a>.</p>

        
<hr class="footer-rule"/>
<footer>
  Parsley is distributed under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD-3-Clause</a> license.
</footer>


      </main>

    </div>

  </body>

</html>