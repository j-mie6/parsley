<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Typelevel Laika + Parsley Theme" />
    
    <title>Constructing Custom Errors (parsley.errors.ErrorBuilder)</title>
    
    
    <meta name="author" content="parsley contributors"/>
    
    
    <meta name="description" content="This page describes how to customise the error type."/>
    
    
    
    <link rel="icon" sizes="32x32" type="image/svg+xml" href="../../../icons/greenLeaf.svg"/>
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
    
    <link rel="stylesheet" type="text/css" href="../../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../helium/site/laika-helium.css" />
    <link rel="stylesheet" type="text/css" href="../../../css/parsley-style.css" />
    <link rel="stylesheet" type="text/css" href="../../../search/search.css" />
    <script src="../../../helium/site/laika-helium.js"></script>
    <script src="../../../helium/site/laika-versions.js"></script>
    <script src="../../../search/protosearch.js"></script>
    <script src="../../../search/searchBar.js"></script>
    <script>initVersions("../../../", "/api-guide/errors/ErrorBuilder.html", "5.0", null);</script>
    
    <script> /* for avoiding page load transitions */ </script>
  </head>


  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>

    <div class="menu-container version-menu">
      <a class="text-link menu-toggle" href="#">Version 5.0.x</a>
      <nav class="menu-content">
        <ul class="nav-list">
        </ul>
      </nav>
    </div>
  </div>

  <a class="icon-link svg-link" href="../../../"><span class="leaf" title="Home"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M101.39,86.21c-14.25-5.91-22.34-4.3-28.47-2.5c-6.5,1.91-12.31,8.58-12.31,8.58s-1.93-0.58-5.04-0.51 c-1.49,0.04-2.67,0.28-3.54,0.54c2.64-5.99,4.51-12.08,7.57-18.76c1.95-0.81,4.63-1.86,6.35-2.23c2.96-0.64,6.45-0.84,6.45-0.84 c0.82,0.64,2,1.39,3.69,2.23c9.56,4.78,21.5,2.16,27.35-0.16c8.13-3.23,20.21-12.95,20.21-13.69s-5.5-3.38-13.32-5.71 c-7.82-2.33-18.27-2.44-26.21,0.95c-7.28,3.11-10.67,8.58-12.54,11.86c0,0-2.9,0.46-5,0.82c-1.56,0.27-2.96,0.64-4.07,0.99 c0.22-0.4,0.45-0.81,0.68-1.21C67.77,58.61,72.83,52.5,77,48.2c5.87,0.55,17.89,0.35,27.62-8.46 c15.64-14.15,18.46-35.92,18.07-36.35S97.35,3.34,84.54,14.91c-12.19,11.01-11.97,25.4-11.4,30.69c-3.97,3.71-8.81,9.17-14.2,17.12 c-0.04-2.12-0.29-4.73-0.29-4.73s7.19-6.73,7.72-17.18c0.42-8.24-0.46-15.89-5-24.14c-3.56-6.43-6.53-8.03-7.06-7.93 c-0.93,0.19-5.33,7.06-8.03,13.63c-2.13,5.17-4.26,18.38-0.45,26.52s8.22,9.68,8.22,9.68s0.54,2.37,0.48,5.55 c-0.02,1.36-0.13,4.51-0.18,5.98c-3.57,6.32-5.96,12.07-8.23,17.22c-0.34-0.99-0.73-1.96-1.11-2.65c-1.16-2.11-1.59-2.85-1.59-2.85 s2.57-15.99-1.8-29.17C36.45,37,27.57,31.08,19.33,27.59C11.09,24.1,6.54,24.11,5.8,24.95c-1.08,1.23,1.37,4.33,1.59,11.31 c0.17,5.71,1.16,25.05,6.87,34.98s13.63,12.37,16.17,13.21c2.54,0.85,8.03,0.95,8.03,0.95s2.33,2.01,3.17,4.86 c0.39,1.31,0.78,2.92,1.09,4.27c-1.95,3.71-4.17,7-7.21,9.86c-5.01,4.71-13.09,7.94-13.09,7.94s-6.47-0.15-6.91,0.15 c-0.44,0.29-1.73,3.53,0.69,7.51c2,3.29,5.05,4.12,6.08,4.26c1.03,0.15,2.94-4.27,3.68-4.86c0.74-0.59,9.43-3.93,15.6-10.74 c2.83-3.13,5.02-6.16,6.81-9.17c1.65-1.01,4.07-2.17,6.72-2.31c2.64-0.15,4.94,1.12,4.94,1.12s2.22,9.16,12.15,13 c12.5,4.83,25.83,0.61,31.64-1.4c5.81-2,19.83-8.42,19.94-10.22C123.86,97.87,115.66,92.13,101.39,86.21z"/>
  </g>
</svg></span></a>

  <div class="row search-row">
    <input id="search-top-bar" class="input" type="text" placeholder="Search">
  </div>
  <div id="search-modal" class="search-modal">
    <div class="search-modal-content">
      <span class="search-close">&times;</span>
      <input id="search-modal-input" class="input" type="text">
      <div id="search-modal-content-body"></div>
    </div>
  </div>

  <div class="row links">
    
    <a class="text-link" href="https://www.javadoc.io/doc/com.github.j-mie6/parsley_2.13/5.0.0-M14/">API</a>
    
    <a class="icon-link svg-link" href="https://github.com/j-mie6/parsley"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
  </div>

</header>

    
    <nav id="sidebar">

  <div class="row">
    
    <a class="text-link" href="https://www.javadoc.io/doc/com.github.j-mie6/parsley_2.13/5.0.0-M14/">API</a>
    
    <a class="icon-link svg-link" href="https://github.com/j-mie6/parsley"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../../downloads.html">Documentation Downloads</a></li>
    <li class="level1 nav-leaf"><a href="../../../home.html">Home</a></li>
    <li class="level1 nav-leaf"><a href="../../faq.html">FAQ</a></li>
    <li class="level1 nav-leaf"><a href="../../cheatsheet.html">Cheatsheet</a></li>
    <li class="level1 nav-node"><a href="../">Understanding the API</a></li>
    <li class="level2 nav-leaf"><a href="../Parsley.html"><code>parsley.Parsley</code></a></li>
    <li class="level2 nav-leaf"><a href="../character.html"><code>parsley.character</code></a></li>
    <li class="level2 nav-leaf"><a href="../combinator.html"><code>parsley.combinator</code></a></li>
    <li class="level2 nav-leaf"><a href="../generic.html"><code>parsley.generic</code></a></li>
    <li class="level2 nav-leaf"><a href="../syntax.html"><code>parsley.syntax</code></a></li>
    <li class="level2 nav-leaf"><a href="../position.html"><code>parsley.position</code></a></li>
    <li class="level2 nav-leaf"><a href="../state.html"><code>parsley.state</code></a></li>
    <li class="level2 nav-leaf"><a href="../debug.html"><code>parsley.debug</code></a></li>
    <li class="level2 nav-header"><code>parsley.expr</code></li>
    <li class="level3 nav-leaf"><a href="../expr/chain.html"><code>chain</code></a></li>
    <li class="level3 nav-leaf"><a href="../expr/infix.html"><code>infix</code></a></li>
    <li class="level3 nav-leaf"><a href="../expr/precedence.html"><code>precedence</code></a></li>
    <li class="level2 nav-header"><code>parsley.token</code></li>
    <li class="level3 nav-leaf"><a href="../token/Lexer.html"><code>Lexer</code></a></li>
    <li class="level3 nav-leaf"><a href="../token/descriptions.html"><code>descriptions</code></a></li>
    <li class="level3 nav-leaf"><a href="../token/errors.html"><code>errors</code></a></li>
    <li class="level2 nav-header"><code>parsley.errors</code></li>
    <li class="level3 nav-leaf"><a href="combinator.html"><code>combinator</code></a></li>
    <li class="level3 nav-leaf"><a href="patterns.html"><code>patterns</code></a></li>
    <li class="level3 active nav-leaf"><a href="#"><code>ErrorBuilder</code></a></li>
    <li class="level3 nav-leaf"><a href="tokenextractors.html"><code>tokenextractors</code></a></li>
    <li class="level1 nav-node"><a href="../../tutorial/">Parser Combinator Tutorial</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/basics-of-combinators.html">Basics of Combinators</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/building-expression-parsers.html">Building Expression Parsers</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/effective-whitespace-parsing.html">Effective Whitespace Parsing</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/effective-lexing.html">Effective Lexing</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/parser-bridge-pattern.html">The Parser Bridge Pattern</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/interlude-1-haskell.html">Interlude 1: Building a Parser for Haskell</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/customising-error-messages.html">Customising Error Messages</a></li>
    <li class="level2 nav-leaf"><a href="../../tutorial/advanced-error-messages.html">Advanced Error Messages</a></li>
    <li class="level1 nav-header">parsley-debug</li>
    <li class="level2 nav-leaf"><a href="../../parsley-debug/debuggable.html"><code>@parsley.debuggable</code></a></li>
    <li class="level2 nav-leaf"><a href="../../parsley-debug/attachment.html">Attaching Debugger Views</a></li>
    <li class="level2 nav-header">Debug Views</li>
    <li class="level3 nav-leaf"><a href="../../parsley-debug/debug-views/PrintView.html"><code>PrintView</code></a></li>
    <li class="level2 nav-leaf"><a href="../../../parsley-debug/recursion-detection.html">Detecting Left Recursion</a></li>
    <li class="level1 nav-header">Related Projects</li>
    <li class="level2 nav-leaf"><a href="https://github.com/j-mie6/parsley-cats">parsley-cats</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/j-mie6/gigaparsec">gigaparsec (Haskell)</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#"><code>ErrorBuilder</code></a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#error-message-structure">Error Message Structure</a></li>
    <li class="level2 nav-leaf"><a href="#vanilla-errors">Vanilla Errors</a></li>
    <li class="level2 nav-leaf"><a href="#specialised-errors">Specialised Errors</a></li>
    <li class="level1 nav-node"><a href="#the-errorbuilder-typeclass">The <code>ErrorBuilder</code> Typeclass</a></li>
    <li class="level2 nav-leaf"><a href="#vanilla">Vanilla</a></li>
    <li class="level2 nav-leaf"><a href="#specialised">Specialised</a></li>
    <li class="level1 nav-leaf"><a href="#constructing-test-errors">Constructing Test Errors</a></li>
  </ul>

  <p class="footer"><a href="https://github.com/j-mie6/parsley/blob/staging/5.0/docs/api-guide/errors/ErrorBuilder.md"><i class="icofont-laika edit" title="Edit">&#xef10;</i>Source for this page</a></p>
</nav>


      <main class="content">

        <h1 id="constructing-custom-errors" class="title">Constructing Custom Errors</h1>
        <p>By default, <code>parsley</code> returns errors that consist of <code>String</code>-based
        content. However, it is possible to build error messages into a
        datatype or format that is user-defined. This is done with the
        <code>ErrorBuilder</code> typeclass.</p>
        <p>The <code>ErrorBuilder</code> is pulled in implicitly by the <code>parse</code> method of
        the <code>Parsley</code> type:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">class</span><span> </span><span class="type-name">Parsley</span><span>[</span><span class="type-name">A</span><span>] {
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">parse</span><span>[</span><span class="type-name">Err</span><span>: </span><span class="type-name">ErrorBuilder</span><span>](</span><span class="identifier">input</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">Result</span><span>[</span><span class="type-name">Err</span><span>, </span><span class="type-name">A</span><span>]
}</span></code></pre>
        <p>This is equivalent to having an implicit parameter of type
        <code>ErrorBuilder[Err]</code>. As the <code>ErrorBuilder</code> companion object has an
        implicit value of type <code>ErrorBuilder[String]</code> only, the type
        <code>String</code> is chosen as the default instantiation of <code>Err</code> by Scala.
        Providing another <code>ErrorBuilder</code> implicit object in a tighter
        scope (or adding an explicit type ascription with another implicit
        object available), you are able to hook in your own type instead.</p>
        <p>This page describes how the <code>ErrorBuilder</code> is structured, and gives
        an example of how to construct a lossy type suitable for unit
        testing generated error messages.</p>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p><em>The Scaladoc for this page can be found at <a class="api" href="https://www.javadoc.io/doc/com.github.j-mie6/parsley_2.13/5.0.0-M14/parsley/errors/ErrorBuilder.html"><code>parsley.errors.ErrorBuilder</code></a>.</em></p>
        </div>
        
        <h2 id="error-message-structure" class="section"><a class="anchor-link left" href="#error-message-structure"><i class="icofont-laika link">&#xef71;</i></a>Error Message Structure</h2>
        <p>Error messages within <code>parsley</code> take two different forms: <em>vanilla</em>
        or <em>specialised</em>. The error chosen depends on the combinators used
        to produce it: <code>empty</code>, <code>unexpected</code>, <code>char</code>, <code>string</code>, etc all produce vanilla errors; and <code>fail</code> and its derivatives produce
        specialised errors. An <code>ErrorBuilder</code> must describe how to build
        both kinds of error; their structure is explained below.</p>
        
        <h3 id="vanilla-errors" class="section"><a class="anchor-link left" href="#vanilla-errors"><i class="icofont-laika link">&#xef71;</i></a>Vanilla Errors</h3>
        <pre><code>┌───────────────────────────────────────────────────────────────────────┐
│                          ┌────────────────┐◄──────── position         │
│                  source  │                │                           │
│                     │    │   line      col│                           │
│                     ▼    │     │         ││                           │
│                  ┌─────┐ │     ▼         ▼│   end of input            │
│               In foo.txt (line 1, column 5):       │                  │
│                 ┌─────────────────────┐            │                  │
│unexpected ─────►│                     │            │  ┌───── expected │
│                 │          ┌──────────┐ ◄──────────┘  │               │
│                 unexpected end of input               ▼               │
│                 ┌──────────────────────────────────────┐              │
│                 expected &quot;(&quot;, &quot;negate&quot;, digit, or letter              │
│                          │    └──────┘  └───┘     └────┘ ◄────── named│
│                          │       ▲        └──────────┘ │              │
│                          │       │                     │              │
│                          │      raw                    │              │
│                          └─────────────────┬───────────┘              │
│                 &#39;-&#39; is a binary operator   │                          │
│                 └──────────────────────┘   │                          │
│                ┌──────┐        ▲           │                          │
│                │&gt;3+4- │        │           expected items             │
│                │     ^│        │                                      │
│                └──────┘        └───────────────── reason              │
│                   ▲                                                   │
│                   │                                                   │
│                   line info                                           │
└───────────────────────────────────────────────────────────────────────┘</code></pre>
        <p>A vanilla error consists of three unique components: the
        <code>unexpected</code> component, which describes the problematic token;
        the <code>expected</code> component, which describes the possible parses that
        would have avoided the error; and the <code>reason</code> component, which
        gives additional context for an error. These are in addition to
        parts shared with <em>specialised</em> errors: the <code>source</code>, <code>position</code>,
        and the <code>lineInfo</code>. Any of the three unique components may be
        missing from the error, and the <code>ErrorBuilder</code> will need to be able
        to handle this.</p>
        <p>Within both <code>unexpected</code> and <code>expected</code>, items can have one of three forms: <code>named</code>, which indicates they came from labels;
        <code>raw</code>, which means they came directly from the input itself; and
        <code>endOfInput</code>, which means no more input was available. All three
        of these states can be formatted independently.</p>
        
        <h3 id="specialised-errors" class="section"><a class="anchor-link left" href="#specialised-errors"><i class="icofont-laika link">&#xef71;</i></a>Specialised Errors</h3>
        <pre><code>┌───────────────────────────────────────────────────────────────────────┐
│                          ┌────────────────┐◄──────── position         │
│                  source  │                │                           │
│                     │    │   line       col                           │
│                     ▼    │     │         │                            │
│                  ┌─────┐ │     ▼         ▼                            │
│               In foo.txt (line 1, column 5):                          │
│                                                                       │
│           ┌───► something went wrong                                  │
│           │                                                           │
│ message ──┼───► it looks like a binary operator has no argument       │
│           │                                                           │
│           └───► &#39;-&#39; is a binary operator                              │
│                ┌──────┐                                               │
│                │&gt;3+4- │                                               │
│                │     ^│                                               │
│                └──────┘                                               │
│                   ▲                                                   │
│                   │                                                   │
│                   line info                                           │
└───────────────────────────────────────────────────────────────────────┘</code></pre>
        <p>In contrast to the <em>vanilla</em> error, specialised errors have one
        unique component, <code>messages</code>, which is zero or more lines of
        bespoke error messages generated by <code>fail</code> combinators.</p>
        
        <h2 id="the-errorbuilder-typeclass" class="section"><a class="anchor-link left" href="#the-errorbuilder-typeclass"><i class="icofont-laika link">&#xef71;</i></a>The <code>ErrorBuilder</code> Typeclass</h2>
        <p>Within the <code>ErrorBuilder</code> trait, there is a number of undefined
        type aliases. Each of these must be implemented by an extender and
        provide an internal type to represent different components within
        the system. These are used to ensure maximal flexiblity of the
        user to pick how each component should be represented without
        exposing unnecessary information into the rest of the system.</p>
        <p>After these types are specified, the methods of the typeclass
        can be implemented. These put together the primtive-most components
        and compose them into the larger whole. The documentation of the
        typeclass details the role of these well enough, however. For example&#39;s sake, however, these
        are the two shapes of call that will be made for the different types of error messages:</p>
        
        <h4 id="vanilla" class="section"><a class="anchor-link left" href="#vanilla"><i class="icofont-laika link">&#xef71;</i></a>Vanilla</h4>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">builder</span><span> = </span><span class="identifier">implicitly</span><span>[</span><span class="type-name">ErrorBuilder</span><span>[</span><span class="type-name">String</span><span>]]
</span><span class="keyword">val</span><span> </span><span class="identifier">err</span><span> = </span><span class="identifier">builder</span><span>.</span><span class="identifier">build</span><span> (
    </span><span class="identifier">builder</span><span>.</span><span class="identifier">pos</span><span>(</span><span class="number-literal">1</span><span>, </span><span class="number-literal">5</span><span>),
    </span><span class="identifier">builder</span><span>.</span><span class="identifier">source</span><span>(</span><span class="type-name">None</span><span>),
    </span><span class="identifier">builder</span><span>.</span><span class="identifier">vanillaError</span><span> (
        </span><span class="identifier">builder</span><span>.</span><span class="identifier">unexpected</span><span>(</span><span class="type-name">Some</span><span>(</span><span class="identifier">builder</span><span>.</span><span class="identifier">endOfInput</span><span>)),
        </span><span class="identifier">builder</span><span>.</span><span class="identifier">expected</span><span> (
            </span><span class="identifier">builder</span><span>.</span><span class="identifier">combineExpectedItems</span><span>(</span><span class="type-name">Set</span><span> (
                </span><span class="identifier">builder</span><span>.</span><span class="identifier">raw</span><span>(</span><span class="string-literal">&quot;(&quot;</span><span>),
                </span><span class="identifier">builder</span><span>.</span><span class="identifier">raw</span><span>(</span><span class="string-literal">&quot;negate&quot;</span><span>),
                </span><span class="identifier">builder</span><span>.</span><span class="identifier">named</span><span>(</span><span class="string-literal">&quot;digit&quot;</span><span>),
                </span><span class="identifier">builder</span><span>.</span><span class="identifier">named</span><span>(</span><span class="string-literal">&quot;letter&quot;</span><span>)
            ))
        ),
        </span><span class="identifier">builder</span><span>.</span><span class="identifier">combineMessages</span><span>(</span><span class="type-name">List</span><span>(
            </span><span class="identifier">builder</span><span>.</span><span class="identifier">reason</span><span>(</span><span class="string-literal">&quot;&#39;-&#39; is a binary operator&quot;</span><span>)
        )),
        </span><span class="identifier">builder</span><span>.</span><span class="identifier">lineInfo</span><span>(</span><span class="string-literal">&quot;3+4-&quot;</span><span>, </span><span class="type-name">Nil</span><span>, </span><span class="type-name">Nil</span><span>, </span><span class="number-literal">1</span><span>, </span><span class="number-literal">4</span><span>, </span><span class="number-literal">1</span><span>)
    )
)</span></code></pre>
        <pre><code>(line 1, column 5):
  unexpected end of input
  expected &quot;(&quot;, &quot;negate&quot;, digit, or letter
  &#39;-&#39; is a binary operator
  &gt;3+4-
       ^</code></pre>
        <p>One builder call not shown here, is a call to
        <code>builder.unexpectedToken</code>. This is a bigger discussion and is
        deferred to <a href="tokenextractors.html#token-extraction-in-errorbuilder">Token Extraction in <code>ErrorBuilder</code></a></p>
        
        <h4 id="specialised" class="section"><a class="anchor-link left" href="#specialised"><i class="icofont-laika link">&#xef71;</i></a>Specialised</h4>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">builder</span><span> = </span><span class="identifier">implicitly</span><span>[</span><span class="type-name">ErrorBuilder</span><span>[</span><span class="type-name">String</span><span>]]
</span><span class="keyword">val</span><span> </span><span class="identifier">err</span><span> = </span><span class="identifier">builder</span><span>.</span><span class="identifier">build</span><span> (
    </span><span class="identifier">builder</span><span>.</span><span class="identifier">pos</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="number-literal">6</span><span>),
    </span><span class="identifier">builder</span><span>.</span><span class="identifier">source</span><span>(</span><span class="type-name">Some</span><span>(</span><span class="string-literal">&quot;foo.txt&quot;</span><span>)),
    </span><span class="identifier">builder</span><span>.</span><span class="identifier">specializedError</span><span> (
        </span><span class="identifier">builder</span><span>.</span><span class="identifier">combineMessages</span><span>(</span><span class="type-name">List</span><span>(
            </span><span class="identifier">builder</span><span>.</span><span class="identifier">message</span><span>(</span><span class="string-literal">&quot;first message&quot;</span><span>),
            </span><span class="identifier">builder</span><span>.</span><span class="identifier">message</span><span>(</span><span class="string-literal">&quot;second message&quot;</span><span>),
        )),
        </span><span class="identifier">builder</span><span>.</span><span class="identifier">lineInfo</span><span>(</span><span class="string-literal">&quot;second line&quot;</span><span>,
                         </span><span class="type-name">List</span><span>(</span><span class="string-literal">&quot;first line of input&quot;</span><span>),
                         </span><span class="type-name">List</span><span>(</span><span class="string-literal">&quot;third line&quot;</span><span>, </span><span class="string-literal">&quot;fourth line&quot;</span><span>),
                         </span><span class="number-literal">2</span><span>,
                         </span><span class="number-literal">5</span><span>,
                         </span><span class="number-literal">3</span><span>)
    )
)</span></code></pre>
        <pre><code>In file &#39;foo.txt&#39; (line 2, column 6):
  first message
  second message
  &gt;first line of input
  &gt;second line
        ^^^
  &gt;third line
  &gt;fourth line</code></pre>
        
        <h2 id="constructing-test-errors" class="section"><a class="anchor-link left" href="#constructing-test-errors"><i class="icofont-laika link">&#xef71;</i></a>Constructing Test Errors</h2>
        <p>As an example of how to construct an <code>ErrorBuilder</code> for a type,
        consider the following representation of <code>TestError</code>:</p>
        <pre><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">TestError</span><span>(</span><span class="identifier">pos</span><span>: (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>), </span><span class="identifier">lines</span><span>: </span><span class="type-name">TestErrorLines</span><span>)

</span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">TestErrorLines</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">VanillaError</span><span>(
    </span><span class="identifier">unexpected</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">TestErrorItem</span><span>],
    </span><span class="identifier">expecteds</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>],
    </span><span class="identifier">reasons</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">String</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">TestErrorLines</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">SpecializedError</span><span>(</span><span class="identifier">msgs</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">String</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">TestErrorLines</span><span>

</span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">TestErrorItem</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">TestRaw</span><span>(</span><span class="identifier">item</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">TestErrorItem</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">TestNamed</span><span>(</span><span class="identifier">item</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">TestErrorItem</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">TestEndOfInput</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">TestErrorItem</span></code></pre>
        <p>This type, as will become evident from the builder derived
        from it, is lossy and does not perfectly encode all the
        information available. Notice that <code>TestErrorItem</code> is a supertype
        of <code>TestRaw</code>, <code>TestNamed</code>, and <code>TestEndOfInput</code>: this is
        required, as the representation of each must all share a common
        supertype.</p>
        <p>To construct an <code>ErrorBuilder[TestError]</code>, the type aliases must
        first be filled in:</p>
        <pre><code class="nohighlight"><span class="keyword">class</span><span> </span><span class="type-name">TestErrorBuilder</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ErrorBuilder</span><span>[</span><span class="type-name">TestError</span><span>] {
    </span><span class="keyword">type</span><span> </span><span class="type-name">Position</span><span> = (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>)
    </span><span class="keyword">type</span><span> </span><span class="type-name">Source</span><span> = </span><span class="type-name">Unit</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">ErrorInfoLines</span><span> = </span><span class="type-name">TestErrorLines</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">Item</span><span> = </span><span class="type-name">TestErrorItem</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">Raw</span><span> = </span><span class="type-name">TestRaw</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">Named</span><span> = </span><span class="type-name">TestNamed</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">EndOfInput</span><span> = </span><span class="type-name">TestEndOfInput</span><span>.</span><span class="keyword">type</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">Message</span><span> = </span><span class="type-name">String</span><span>
    </span><span class="keyword">type</span><span> </span><span class="type-name">Messages</span><span> = </span><span class="type-name">Set</span><span>[</span><span class="type-name">String</span><span>]
    </span><span class="keyword">type</span><span> </span><span class="type-name">ExpectedItems</span><span> = </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>]
    </span><span class="keyword">type</span><span> </span><span class="type-name">ExpectedLine</span><span> = </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>]
    </span><span class="keyword">type</span><span> </span><span class="type-name">UnexpectedLine</span><span> = </span><span class="type-name">Option</span><span>[</span><span class="type-name">TestErrorItem</span><span>]
    </span><span class="keyword">type</span><span> </span><span class="type-name">LineInfo</span><span> = </span><span class="type-name">Unit</span><span>
    </span><span class="comment">//...
</span><span>}</span></code></pre>
        <p>These types can be determined by examining the shape of <code>TestError</code>: for bits that it doesn&#39;t work, these are set to <code>Unit</code>. With these in place, the refined types of the typeclass
        methods make it very easy to fill in the gaps:</p>
        <pre><code class="nohighlight"><span class="keyword">class</span><span> </span><span class="type-name">TestErrorBuilder</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ErrorBuilder</span><span>[</span><span class="type-name">TestError</span><span>] {
    </span><span class="comment">//...
</span><span>    </span><span class="keyword">def</span><span> </span><span class="declaration-name">build</span><span>(</span><span class="identifier">pos</span><span>: (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>), </span><span class="identifier">source</span><span>: </span><span class="type-name">Unit</span><span>,
              </span><span class="identifier">lines</span><span>: </span><span class="type-name">TestErrorLines</span><span>): </span><span class="type-name">TestError</span><span> = </span><span class="type-name">TestError</span><span>(</span><span class="identifier">pos</span><span>, </span><span class="identifier">lines</span><span>)
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">vanillaError</span><span>(
        </span><span class="identifier">unexpected</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">TestErrorItem</span><span>],
        </span><span class="identifier">expected</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>],
        </span><span class="identifier">reasons</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">String</span><span>],
        </span><span class="identifier">line</span><span>: </span><span class="type-name">Unit</span><span>
      ): </span><span class="type-name">TestErrorLines</span><span> = </span><span class="type-name">VanillaError</span><span>(</span><span class="identifier">unexpected</span><span>, </span><span class="identifier">expected</span><span>, </span><span class="identifier">reasons</span><span>)
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">specializedError</span><span>(
        </span><span class="identifier">msgs</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">String</span><span>],
        </span><span class="identifier">line</span><span>: </span><span class="type-name">Unit</span><span>
      ): </span><span class="type-name">TestErrorLines</span><span> = </span><span class="type-name">SpecializedError</span><span>(</span><span class="identifier">msgs</span><span>)
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">pos</span><span>(</span><span class="identifier">line</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">col</span><span>: </span><span class="type-name">Int</span><span>): (</span><span class="type-name">Int</span><span>, </span><span class="type-name">Int</span><span>) = (</span><span class="identifier">line</span><span>, </span><span class="identifier">col</span><span>)
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">source</span><span>(</span><span class="identifier">sourceName</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">String</span><span>]): </span><span class="type-name">Unit</span><span> = ()
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">combineExpectedItems</span><span>(</span><span class="identifier">alts</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>]): </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>] = </span><span class="identifier">alts</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">combineMessages</span><span>(</span><span class="identifier">alts</span><span>: </span><span class="type-name">Seq</span><span>[</span><span class="type-name">String</span><span>]): </span><span class="type-name">Set</span><span>[</span><span class="type-name">String</span><span>] = </span><span class="identifier">alts</span><span>.</span><span class="identifier">toSet</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">unexpected</span><span>(</span><span class="identifier">item</span><span>: </span><span class="type-name">Option</span><span>[</span><span class="type-name">TestErrorItem</span><span>]): </span><span class="type-name">Option</span><span>[</span><span class="type-name">TestErrorItem</span><span>] = </span><span class="identifier">item</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">expected</span><span>(</span><span class="identifier">alts</span><span>: </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>]): </span><span class="type-name">Set</span><span>[</span><span class="type-name">TestErrorItem</span><span>] = </span><span class="identifier">alts</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">message</span><span>(</span><span class="identifier">msg</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">String</span><span> = </span><span class="identifier">msg</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">reason</span><span>(</span><span class="identifier">msg</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">String</span><span> = </span><span class="identifier">msg</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">raw</span><span>(</span><span class="identifier">item</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">TestRaw</span><span> = </span><span class="type-name">TestRaw</span><span>(</span><span class="identifier">item</span><span>)
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">named</span><span>(</span><span class="identifier">item</span><span>: </span><span class="type-name">String</span><span>): </span><span class="type-name">TestNamed</span><span> = </span><span class="type-name">TestNamed</span><span>(</span><span class="identifier">item</span><span>)
    </span><span class="keyword">val</span><span> </span><span class="identifier">endOfInput</span><span>: </span><span class="type-name">TestEndOfInput</span><span>.</span><span class="keyword">type</span><span> = </span><span class="type-name">TestEndOfInput</span><span>

    </span><span class="keyword">val</span><span> </span><span class="identifier">numLinesAfter</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="number-literal">0</span><span>
    </span><span class="keyword">val</span><span> </span><span class="identifier">numLinesBefore</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="number-literal">0</span><span>
    </span><span class="keyword">def</span><span> </span><span class="declaration-name">lineInfo</span><span>(
        </span><span class="identifier">line</span><span>: </span><span class="type-name">String</span><span>,
        </span><span class="identifier">linesBefore</span><span>: </span><span class="type-name">Seq</span><span>[</span><span class="type-name">String</span><span>],
        </span><span class="identifier">linesAfter</span><span>: </span><span class="type-name">Seq</span><span>[</span><span class="type-name">String</span><span>],
        </span><span class="identifier">lineNum</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">errorPointsAt</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">errorWidth</span><span>: </span><span class="type-name">Int</span><span>
      ): </span><span class="type-name">Unit</span><span> = ()

    </span><span class="comment">// The implementation of this is usually provided by a mixed-in
</span><span>    </span><span class="comment">// token extractor, discussed in `tokenextractors`
</span><span>    </span><span class="keyword">def</span><span> </span><span class="declaration-name">unexpectedToken</span><span>(
        </span><span class="identifier">cs</span><span>: </span><span class="type-name">Iterable</span><span>[</span><span class="type-name">Char</span><span>],
        </span><span class="identifier">amountOfInputParserWanted</span><span>: </span><span class="type-name">Int</span><span>,
        </span><span class="identifier">lexicalError</span><span>: </span><span class="type-name">Boolean</span><span>
      ): </span><span class="type-name">Token</span><span> = ???
}</span></code></pre>
        <p>Each of the methods above do the bare minimum work to
        satisfy the types. As noted in the comment, the implementation
        of <code>unexpectedToken</code> is usually done by mixing in a
        <em>token extractor</em>, which is explained <a href="tokenextractors.html#token-extraction-in-errorbuilder">here</a>.</p>

        
<hr class="footer-rule"/>
<footer>
  Parsley is distributed under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD-3-Clause</a> license.
</footer>


      </main>

    </div>

  </body>

</html>